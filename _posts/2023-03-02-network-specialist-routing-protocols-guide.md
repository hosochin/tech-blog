---
layout: post
title: 【ネスペ対策】【RIP/OSPF/BGP】ルーティングプロトコルの全体像について整理する
date: 2023-03-02
tags: [network, routing, rip, ospf, bgp, network-specialist, ipa]
---

# はじめに

お世話になります、hosochinです  
今回はIPAのネットワークスペシャリスト対策ってことでルーティングについてです  
ここでは主なルーティングプロトコルである **「RIP」「OSPF」「BGP」** らへんについて、ごっちゃになっちゃってる人向けに（僕のことです）整理したいと思います

# 目次

- [キーワードから全体像を把握する](#キーワードから全体像を把握する)
- [ルーティング](#ルーティング)
- [動的ルーティングの主なプロトコル](#動的ルーティングの主なプロトコル)
- [IGP](#igp)
  - [RIP](#rip)
  - [RIP2](#rip2)
  - [OSPF](#ospf)
- [EGP](#egp)
  - [BGP](#bgp)

# キーワードから全体像を把握する

まずは全体像について僕の理解をメモっときます

<img src="{{ '/assets/images/2023-03-02_1.png' | relative_url }}" alt="Vegeta Logo" width="700">

# ルーティング

ルーティングは主に **「静的ルーティング」** と **「動的ルーティング」** に分けられます

| 種別 | ルーティング方法 | メリット | デメリット |
|---|---|---|---|
| 静的ルーティング | ルータなどに固定的に経路情報を設定する | ・設計した人の意図どおり経路選択される | ・大規模の場合、管理者の負担が大きい<br>・障害時なども管理者が手作業で対応する必要がある |
| 動的ルーティング | ルーティングプロトコル（RIP, RIP2, OSPF, BGPなど）がやってくれる | ・自動で経路選択してくれる<br>・障害時に自動で経路変更してくれる | ・ルータの負荷が増える |

# 動的ルーティングの主なプロトコル

動的ルーティングは主に **「IGP」** と **「EGP」** に分けられます  
**IGP = Interior Gateway Protocol**  
**EGP = Exterior Gateway Protocol**  
ですね

| 種別 | 特徴 | 主なプロトコル |
|---|---|---|
| IGP | AS内で経路情報を交換し合うプロトコル | RIP, RIP2, OSPF |
| EGP | AS間で経路情報を交換し合うプロトコル | BGP |

**AS = Autonomous System : 自律システム** のことで、同じルーティングポリシーの下で動作するルータの集合体のことです  
例えば地域ネットワークや大きなISP（インターネットサービスプロバイダ）が挙げられます  
**IGP** は **AS** （ISP） **内** の中で経路情報を交換し合うプロトコル  
**EGP** は異なる **AS** （ISP） **間** の経路情報を交換し合うプロトコル  
となります

# IGP

AS内で経路情報を交換し合うプロトコルです  
経路制御のアルゴリズムには様々な方法がありますが、ネスペで問われる範囲で言うと主に2つで、  
**距離ベクトル型** と **リンク状態型** があります

| 種別 | 特徴 | メリット | デメリット | 主なプロトコル |
|---|---|---|---|---|
| 距離ベクトル型 | ・ルーター間ではネットワークの向きと距離の情報が交換される | ・計算処理はリンク状態型に比べシンプルなため比較的軽量 | ・ネットワークの構造が複雑になると、経路制御情報が安定するまでに時間がかかる<br>・個々の回線速度が考慮されないため、結果的に最適な経路とならない場合がある | RIP, RIP2 |
| リンク状態型 | ・各ルータがネットワーク全体の接続状態を保持する | ・ネットワークが複雑になっても各ルーターは正しい経路選択ができる | ・複雑なネットワークであれば各ルータでこなす計算も複雑になるため、高いCPU能力と多くのメモリ資源が必要になる | OSPF |

## RIP

**RIP** = **Routing Information Protocol** は距離ベクトル型であるため、 **「方向」** と **「距離」** によって最適経路を計算します  
・方向 = 情報を伝える隣接ルータのIPアドレスである **「ネクストホップ」**  
・距離 = 通過するルータの数である **「ホップ数」**  
宛先までに通過するルータ数 = ホップ数が少ない経路が最適経路として計算されます  
RIPは定期的にネットワーク上に **UDP** で **ブロードキャスト** による経路情報を交換します  
この経路制御情報の送信間隔は **30秒間隔** で、ホップ数は **最大15** となっています（16を超える場合はネットワークに到達不能と判断します）  
ただ、途中の経路が冗長構成になっている場合に **ルーティングループ** を引き起こす可能性があります  
また、RIPは **クラス** を見て判断するため **サブネットマスク** を利用した構成の場合は注意が必要です

## RIP2

RIPの改善バージョンになります  
RIPに比べて主に以下の機能が追加されました

- **マルチキャスト**
  - RIPはブロードキャストで経路情報を交換していましたが、RIP2ではマルチキャストを使用します  
トラフィックの軽減と、関係のないルータに与える影響を軽減します
- **サブネットマスクの対応**
  - RIPではクラスの概念がありましたが、RIP2ではクラスレスでサブネットを見て判断できるようになりました
- **認証**
  - 認証の通ったパケットのみを受容することができるためセキュリティ面が向上します

## OSPF

**OSPF = Open Shortest Path First** はリンク状態型のルーティングプロトコルです  
RIPに対して以下のメリットが挙げられます

- サブネットマスクに対応
- エリアの概念の導入
  - ネットワークをエリアに分けることで不必要なルーティングプロトコルのやりとりを減少させ、トラフィックを軽減できます
- コストの概念の導入
  - 各ルータごとの回線速度をコストとして管理することで、より最適な経路選択が可能になりました
- ルーティングループの解消
  - 各ルータがネットワークの全体の接続情報を保持することで、ルーティングループが発生しないようになります

### OSPFの動作イメージ

以下にOSPFの経路情報交換の動作イメージを示します

### 1. HELLOパケットによるネイバー関係の確立

隣接ルーターにHELLOパケットを送信しネイバー関係を確立・維持します

### 2. ルータ同士でLSAの交換

**LSA = Link State Advertisement** と呼ばれる情報を交換することで経路情報を把握します  
LSAにはルーターID, リンク数, コストなどの情報が含まれます  
また、ルータにもそれぞれ種類があり、ルータの種類に応じてLSAにも種類があります

| ルータの種別 | 概要 |
|---|---|
| 代表ルータ<br>DR = Designated Router | ・エリア内に1つずつ選出された代表となるルータ<br>・リンク情報を全てのルータと交換する |
| エリア境界ルータ<br>ABR = Area Border Router | ・エリアの境界にあるルータ |
| AS境界ルータ<br>ASBR = AS Boundary Router | ・ASの境界にあるルータ |

<img src="{{ '/assets/images/2023-03-09_4.png' | relative_url }}" alt="OSPFルータ種別" width="600">

### 3. 各ルータがLSAを元に経路制御表を作成する

# EGP

AS間で経路情報を交換し合うプロトコルです  
主なプロトコルとしてBGPがあります

## BGP

**BGP = Border Gateway Protocol** は **経路ベクトル型** のプロトコルです  
BGPでは通過するASの数をもとに経路制御を行います  
RIPの距離ベクトル型と似ていますが、RIPの場合はホップ数のみを保持していて、BGPでは経由するASを全て保持している点で違います  
このためBGPではループが発生しません  
BGPのキーワードとして **「BGPスピーカー」 **「EBGP」** 「IBGP」**があります

### BGPスピーカー

BGPによって経路制御情報を交換するルータ

### EBGPとIBGP

- **EBGP = External BGP**
  - AS間でBGPによる経路制御情報を交換する
- **IBGP = Internal BGP**
  - AS内部でBGPによる経路制御情報を交換する
  - 異なるAS間を接続するためにはAS内でもBGPを動作させる必要がある
  - そのためのルーティングプロトコルがIBGP

# まとめ

ネットワークスペシャリスト試験で重要なルーティングプロトコルについて整理しました。IGP（AS内）とEGP（AS間）の違い、各プロトコルの特徴と動作原理を理解することが重要です。特にOSPFの動作メカニズムとBGPの経路ベクトル型の仕組みは頻出ポイントです。
