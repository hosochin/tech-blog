---
layout: post
title: 【ネスペ対策】【IKE】IKEの概要について理解する
date: 2023-03-21
tags: [network, ike, ipsec, vpn, key-exchange, network-specialist, ipa, security]
---

# はじめに

お世話になります、hosochinです  
今回はIPAのネットワークスペシャリスト対策ってことで **IKE** についてです  
IPsecで使われる鍵交換プロトコルのやつですね、概要について理解していきたいと思います

# 目次

- [IKEとは](#ikeとは)
- [IKEのモードについて](#ikeのモードについて)
  - [メインモード](#メインモード)
  - [アグレッシブモード](#アグレッシブモード)
- [IKEを使った鍵交換の流れ](#ikeを使った鍵交換の流れ)
  - [フェーズ1](#フェーズ1)
  - [フェーズ2](#フェーズ2)

# IKEとは

**IKE = Internet Key Exchange** はIPsec通信のための鍵交換を安全に行うプロトコルです  
IKEには **バージョン1** と **バージョン2** があり、バージョン1の方が仕様が複雑なため試験で問われやすいです

ということでこの記事ではIKEのバージョン1について取り扱います(以降「IKE」とはバージョン1のことを指します)

# IKEのモードについて

IKEの実行モードには **メインモード** と **アグレッシブモード** の2種類があります  
**・メインモード** ・・・ **IPsecのトンネルモード(拠点間VPNなど)**  
**・アグレッシブモード** ・・・ **IPsecのトランスポートモード(リモートアクセスVPNなど)**  
で使い分けられます  
IPsecのモードについては以下の記事でまとめているのでよかったら参照してみてください

> 関連記事：【ネスペ対策】VPNの全体像について整理する

## メインモード

IPsec接続先の **IPアドレスを認証情報** として利用するモードです  
そのため接続する両者に **固定のグローバルIPアドレス** が必要となります  
IPsecのトンネルモードで利用されます

## アグレッシブモード

IPsec接続先のIPアドレスが動的IPアドレスでも使用できるモードです  
IPsecのトランスポートモード（例えばリモートワークといった自宅のIPアドレスが動的に変わってしまう環境）でも利用可能です  
メインモードに対しセキュリティ強度は劣ります(IPアドレスは偽装が難しい点などから)

# IKEを使った鍵交換の流れ

IKEの鍵交換はフェーズ1とフェーズ2の2つのステップに分かれます  
大まかには各フェーズには以下の役割があります  
**・フェーズ1** ・・・「**ISAKMP SA**」と呼ばれる制御用のSAを生成  
**・フェーズ2** ・・・「**IPsec SA**」と呼ばれる実際のデータ通信用のSAを生成  
**SA = Security Association** とはVPN装置間で確立するコネクションのことです  
ここらへんのIPsecで登場する用語などについては以下の記事にまとめています

> 関連記事：【ネスペ対策】VPNの全体像について整理する

## フェーズ1

**ISAKMP SA** と呼ばれる制御用のSAを生成します  
アイサキャンプエスエー, アイサカンプエスエーって発音するらしいっす(僕はイサクエムピーって読んでました…🍺)  
フェーズ1では、相手方の認証、暗号化アルゴリズム、鍵交換方式、鍵長などが決定され、その結果、双方で共通の秘密鍵が生成されます  
実際のIPsecのデータ通信に利用する **SA** は後述するフェーズ2で生成されます

## フェーズ2

**IPsec SA** とよばれる実際のデータ通信用のSAが生成されます  
この際にフェーズ1で生成された **ISAKMP SA** が使用され、暗号化アルゴリズム, ハッシュアルゴリズム, 認証アルゴリズム, 暗号鍵などが交換されます  
ちなみに **IPsec SA** は双方向の通信を実現するため2つ確立されます  
**IPsec SA** は一方通行のトンネルのため、送信用と受信用で2つ必要になるためです( **ISAKMP SA** は双方向のやりとりが可能なためコネクションは1つですむ)  
また、フェーズ2では **ESP** , **AH** の2つのプロトコルに対応しています

# まとめ

IKEはIPsecVPNにおける安全な鍵交換を実現する重要なプロトコルです。メインモード（固定IP用）とアグレッシブモード（動的IP対応）の使い分け、フェーズ1でのISAKMP SA確立とフェーズ2でのIPsec SA生成の2段階プロセスを理解することが、ネットワークスペシャリスト試験での重要なポイントです。